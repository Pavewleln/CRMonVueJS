"use strict";(self["webpackChunksrm"]=self["webpackChunksrm"]||[]).push([[393],{3393:function(e,t,a){a.r(t),a.d(t,{default:function(){return z}});var l=a(3396),r=a(9242),n=a(7139);const o={class:"app-page"},i=(0,l._)("div",{class:"page-title"},[(0,l._)("h3",null,"Новая запись")],-1),u={key:1,class:"center"},s={class:"input-field"},c=["value"],d=(0,l._)("label",null,"Выберите категорию",-1),p={key:0,class:"helper-text invalid"},y=(0,l._)("span",null,"Доход",-1),g=(0,l._)("span",null,"Расход",-1),m={class:"input-field"},v=(0,l._)("label",{for:"amount"},"Сумма",-1),w={key:0,class:"helper-text invalid"},h={class:"input-field"},b=(0,l._)("label",{for:"description"},"Описание",-1),f={key:0,class:"helper-text invalid"},_=(0,l._)("button",{class:"btn waves-effect waves-light",type:"submit"},[(0,l.Uk)(" Создать "),(0,l._)("i",{class:"material-icons right"},"send")],-1);function k(e,t,a,k,U,B){const D=(0,l.up)("AppLoader"),S=(0,l.up)("router-link");return(0,l.wg)(),(0,l.iD)("div",o,[(0,l._)("div",null,[i,e.loading?((0,l.wg)(),(0,l.j4)(D,{key:0})):e.categories.length?((0,l.wg)(),(0,l.iD)("form",{key:2,class:"form",onSubmit:t[7]||(t[7]=(0,r.iM)(((...t)=>e.onSubmit&&e.onSubmit(...t)),["prevent"]))},[(0,l._)("div",s,[(0,l.wy)((0,l._)("select",{ref:"select","onUpdate:modelValue":t[0]||(t[0]=t=>e.category=t)},[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.categories,(e=>((0,l.wg)(),(0,l.iD)("option",{key:e.id,value:e.id},(0,n.zw)(e.title),9,c)))),128))],512),[[r.bM,e.category]]),d,e.cError?((0,l.wg)(),(0,l.iD)("p",p,(0,n.zw)(e.cError),1)):(0,l.kq)("",!0)]),(0,l._)("p",null,[(0,l._)("label",null,[(0,l.wy)((0,l._)("input",{checked:"",class:"with-gap",name:"type",type:"radio",value:"income","onUpdate:modelValue":t[1]||(t[1]=t=>e.type=t)},null,512),[[r.G2,e.type]]),y])]),(0,l._)("p",null,[(0,l._)("label",null,[(0,l.wy)((0,l._)("input",{class:"with-gap",name:"type",type:"radio",value:"outcome","onUpdate:modelValue":t[2]||(t[2]=t=>e.type=t)},null,512),[[r.G2,e.type]]),g])]),(0,l._)("div",m,[(0,l.wy)((0,l._)("input",{id:"amount",type:"number","onUpdate:modelValue":t[3]||(t[3]=t=>e.amount=t),onBlur:t[4]||(t[4]=(...t)=>e.aBlur&&e.aBlur(...t))},null,544),[[r.nr,e.amount]]),v,e.aError?((0,l.wg)(),(0,l.iD)("span",w,(0,n.zw)(e.aError),1)):(0,l.kq)("",!0)]),(0,l._)("div",h,[(0,l.wy)((0,l._)("input",{id:"description",type:"text","onUpdate:modelValue":t[5]||(t[5]=t=>e.description=t),onBlur:t[6]||(t[6]=(...t)=>e.dBlur&&e.dBlur(...t))},null,544),[[r.nr,e.description]]),b,e.dError?((0,l.wg)(),(0,l.iD)("span",f,(0,n.zw)(e.dError),1)):(0,l.kq)("",!0)]),_],32)):((0,l.wg)(),(0,l.iD)("p",u,[(0,l.Uk)("Категорий пока нет. "),(0,l.Wm)(S,{to:"/categories"},{default:(0,l.w5)((()=>[(0,l.Uk)("Добавить категорию")])),_:1})]))])])}var U=a(4870),B=a(65),D=a(9877),S=a(5708),E=a(3634);const q=(e,t)=>{const{handleSubmit:a,isSubmitting:l}=(0,S.cI)(),{value:r}=(0,S.U$)("type");r.value="income";const{value:n,errorMessage:o,handleBlur:i}=(0,S.U$)("amount",E.Rx().min(1,"Число должно быть больше 1").required("Обязательно для заполнения")),{value:u,errorMessage:s,handleBlur:c}=(0,S.U$)("description",E.Z_().trim().required("Обязательно для заполнения")),{value:d,errorMessage:p}=(0,S.U$)("category",E.Z_().required("Обязательно для заполнения"));d.value=t[0];const y=a(e);return{isSubmitting:l,type:r,amount:n,dError:s,dBlur:c,onSubmit:y,category:d,aError:o,aBlur:i,description:u,cError:p}};var M=a(2316),x={components:{AppLoader:D.Z},setup:function(){const e=(0,U.iH)(null),t=(0,U.iH)(!0),a=(0,B.oR)();(0,l.bv)((async()=>{t.value=!0,await a.dispatch("category/getAllCategory"),t.value=!1,setTimeout((()=>{e.value=window.M.FormSelect.init(e.value)}),0)}));const r=(0,l.Fl)((()=>a.getters["category/category"]));(0,l.Ah)((()=>{e.value&&e.value.destroy&&e.value.destroy()}));const n=async e=>{if("income"===e.type)try{await a.dispatch("record/createRecord",{categoryId:e.category,amount:e.amount,description:e.description,type:e.type,date:(new Date).toJSON()});const t=a.getters["auth/info"].bill+e.amount;await a.dispatch("auth/updateInfo",{bill:t}),e=null,(0,M.U)("Запись успешно создана")}catch(t){console.log(t)}else if(a.getters["auth/info"].bill>=e.amount)try{await a.dispatch("record/createRecord",{categoryId:e.category,amount:e.amount,description:e.description,type:e.type,date:(new Date).toJSON()});const t=a.getters["auth/info"].bill-e.amount;await a.dispatch("auth/updateInfo",{bill:t}),e.amount="",e.description="",(0,M.U)("Запись успешно создана")}catch(t){console.log(t)}else(0,M.U)("У вас не достаточно средств")};return{select:e,categories:r,loading:t,...q(n,r)}}},I=a(89);const V=(0,I.Z)(x,[["render",k]]);var z=V}}]);
//# sourceMappingURL=393.e275138c.js.map